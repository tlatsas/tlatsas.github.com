

<!doctype html>
  <!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
  <!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
  <!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
  <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>using git rebase to remove duplicate cherry-picked commits - > kodama.gr_</title>
    <meta name="author" content="Tasos Latsas">
    
    <meta name="description" content="using git rebase to remove duplicate cherry-picked commits Jul 28th, 2013 git rebase cherry-pick Git cherry-pick is a great tool, it allows you to &hellip;">
    
    <meta name="viewport" content="width=device-width">
    
    <link rel="canonical" href="http://www.kodama.gr/2013/07/28/using-git-rebase-to-remove-duplicate-cherry-picked-commits">
    <link href="/favicon.png" rel="icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet">
    <link href="//atom.xml" rel="alternate" title="> kodama.gr_" type="application/atom+xml">
  </head>


  <body >

    <header>
      <div class="grid-wrapper">
  <div class="grid">

    <div class="grid__item two-fifths lap-four-sixths palm-one-whole">
  <a href="/" class="site-title">> kodama.gr_</a>
</div>

<div class="grid__item three-fifths lap-two-sixths palm-one-whole">
  <nav>
    <input type="checkbox" id="toggle">
<label for="toggle" class="toggle" data-open="Main Menu" data-close="Close Menu"></label>
<ul class="menu pull-right">
  <li><a href="/">blog</a></li>
  <li><a href="/archives/">archives</a></li>
  <li><a href="/categories/">categories</a></li>
  <li><a href="/projects/">projects</a></li>
  <li><a href="/about/">about</a></li>
</ul>

  </nav>
</div>

  </div>
</div>
    </header>

    

    <div class="grid-wrapper">
      <div class="grid grid-center">
        
        <div class="grid__item two-thirds lap-one-whole palm-one-whole">
        

          <article class="post">
  <header>
  
  <h1 class="title indent">using git rebase to remove duplicate cherry-picked commits</h1>
  

  
  <div class="meta clearfix">
    








  


<time class="pull-left" datetime="2013-07-28T04:06:37+03:00" pubdate data-updated="true"><i class="icon-calendar"></i> Jul 28<span>th</span>, 2013</time>
    



  
  <div class="pull-left">
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      <li><a href="/categories/git/">git</a></li>
    
      <li><a href="/categories/rebase/">rebase</a></li>
    
      <li><a href="/categories/cherry-pick/">cherry-pick</a></li>
    
    </ul>
  </div>
  

    
  </div>
  
</header>




  <p>Git cherry-pick is a great tool, it allows you to select individual commits
from a branch and merge them into another. However, if the branch that you
cherry-picked from is eventually merged to the same branch that the individual
commits landed, you end up with duplicate commits.</p>

<p>To demonstrate this behaviour, we assume that we are working on a project
and at some point, we branched off to a <strong>dev</strong> branch to work on some exciting
new feature. As we are working we find some other important issues, or maybe
some minor issues that are not relevant to the new feature and decide to fix
them too. Now, there are two approaches we can take in such situation. The
first is to commit in our current branch and then use <code>git cherry-pick</code> to
introduce these changes to the <strong>master</strong> (or some other) branch. The second
approach is to <strong>stash</strong> any unsaved changes, create another branch
and commit these changes there. I personally prefer the second approach
as it makes your life way easier if your are contributing on a
project and need to make a pull request on Github or create a patch.
For our example, we will take the first approach and commit anyway.</p>

<p>So, after some work on the <strong>dev</strong> branch, the tree will look like this:</p>

<p><img src="/images/dev-branch.png" alt="dev branch" /></p>

<p>I have used silly commit messages like “cherry-pick this commit” to
indicate which commits we will cherry-pick into the <strong>master</strong>
branch. Let’s do that now:</p>

<pre><code>$ git checkout master
$ git cherry-pick e22c44f
$ git cherry-pick 1a2929a
</code></pre>

<p>If we use <code>git log</code> on master, we will notice that we have our new
commits, but with different SHA-1 hashes. This is happening because when
we cherry-pick commits, git creates <strong>new</strong>
commits on the <strong>master</strong> branch which introduce
the changes of these commits. At this point, the state of
the repo is the following:</p>

<p><img src="/images/after-cp.png" alt="repot state after cherry-pick" /></p>

<p>At some point, we are happy with the work on the <strong>dev</strong> branch, and
decide to merge the <strong>dev</strong> into <strong>master</strong>. However the <strong>master</strong>
branch has changes since the time we initially branched to work on our
features. This means that we <strong>cannot</strong> use a <strong>fast-forward</strong> merge.
If we switch to <strong>master</strong> branch and run <code>git merge dev</code> then a new
commit will be introduced. This is the standard behaviour of git when
doing <strong>no-fast-forward</strong> merges. Sometimes this may be desirable, but
some other times we prefer a linear history. This will be the repository
state after a merge:</p>

<p><img src="/images/no-ff-merge.png" alt="repo state after merge" /></p>

<p>And a <code>git log --oneline</code> will look like this:</p>

<pre><code>b05bcc3 Merge branch 'dev'
b47ebea 2nd commit to cherry-pick
9d190e9 cherry pick this commit
8c0a87e some more work before merging
d1c9568 2nd commit to cherry-pick
9d4575e even more commits
790c30a some more commits!
ac60758 more commits on dev branch
03725e0 cherry pick this commit
2e106d4 1st commit at dev branch
ee38cc6 second commit at master
444357a initial commit
</code></pre>

<p>Notice that except from the (ugly) new commit on top, we also ended up
with duplicate commits for each cherry-picked commit. Also, if you care
enough to use the <code>git show</code> command you will notice
that these duplicate commits contain the same changes.</p>

<p>This is where the <code>rebase</code> command comes into play. Rebase can be used
to rewrite the git history. It allows us to extract the changes of a
commit(s) and re-apply it ontop of a branch.</p>

<p>We will use it to introduce the new commits of
the <strong>master</strong> branch to our <strong>dev</strong> branch and then replay all the
work of the <strong>dev</strong> branch on top of these commits. In our use case,
the “new” commits of the <strong>master</strong> branch are the cherry-picked
changes. When rebase will start to re-apply our work, it is smart
enough to not apply the same changes the second time, and thus removing
the duplicate commits. Running:</p>

<pre><code>git checkout dev
git rebase master
</code></pre>

<p>will bring our repository in the following state:</p>

<p><img src="/images/after-rebase.png" alt="repo state after rebase" /></p>

<p>As you can see, the cherry-picked commits look like they never
existed on the <strong>dev</strong> branch. Also, now we can use a <strong>fast-forward</strong>
merge:</p>

<pre><code>git checkout master
git merge --ff dev
</code></pre>

<p>You can find more information about rebasing and cherry-pick at the
<a href="http://git-scm.com/">git-book</a> and the relevant
<a href="https://www.kernel.org/pub/software/scm/git/docs/">man pages</a>.</p>


</article>

 
<section id="disqus">
  <h1 class="indent title">Comments</h1>
  <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>

        
        </div>
        
        
        <aside id="sidebar" class="grid__item one-third lap-one-whole palm-one-whole">
          <div class="grid">

  
<section class="social aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">
    Follow me!
  </h1>
  <ul class="unstyled">
    
    
    <li><a class="github" href="//github.com/tlatsas"><i class="icon-github"></i> Github</a></li>
    
    <li><a class="gplus" href="//plus.google.com/113297710160205489384"><i class="icon-google-plus-sign"></i> Google+</a></li>
    <li><a class="linkedin" href="//linkedin.com/in/tasoslatsas"><i class="icon-linkedin-sign"></i> LinkedIn</a></li>
    
    <li><a class="stackoverflow" href="//stackoverflow.com/users/1208521"><i class="icon-stackexchange"></i> StackOverflow</a></li>
    <li><a class="twitter" href="//twitter.com/tlatsas"><i class="icon-twitter"></i> Twitter</a></li>
    
  </ul>
</section>


  <section id="recent-posts" class="aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">Recent Posts</h1>
  <ul class="divided">
    
      <li class="post">
        <a href="/2013/11/03/reading-from-named-pipes-in-xmobar/">reading from named pipes in xmobar</a>
      </li>
    
      <li class="post">
        <a href="/2013/07/28/using-git-rebase-to-remove-duplicate-cherry-picked-commits/">using git rebase to remove duplicate cherry-picked commits</a>
      </li>
    
      <li class="post">
        <a href="/2013/07/23/preview-sphinx-documentation/">preview sphinx documentation</a>
      </li>
    
      <li class="post">
        <a href="/2013/04/29/installing-Arch-Linux-ARM-in-Raspberry-Pi/">installing Arch Linux ARM in Raspberry Pi</a>
      </li>
    
      <li class="post">
        <a href="/2012/09/28/adjusting-HDD-spindown-with-systemd-service-files/">adjusting HDD spindown with systemd service files</a>
      </li>
    
  </ul>
</section>

<section id="github-repos" class="aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">
    GitHub Repos
    
    <small class="pull-right">
      <a class="btn" href="//github.com/tlatsas" title="@tlatsas on GitHub" target="_blank">
        <i class="icon-external-link"></i>
      </a>
    </small>
    
  </h1>
  <ul id="gh_repos" class="divided">
    <li class="loading">
      <i class="icon-spinner icon-spin"></i>
    </li>
  </ul>
</section>



</div>

        </aside>
        
      </div>
    </div>
    
    <footer>
      <div class="grid-wrapper">
  <div class="grid">
    <div class="grid__item">
      <p class="copyright">
  All content by Tasos Latsas and licenced under <a href="//creativecommons.org/licenses/by-nc-sa/3.0/ie/">Creative Commons</a>.<br>
  Code under <a href="//github.com/coogie/oscailte/blob/master/README.md">MIT Licence</a>.
</p>
    </div>
  </div>
</div>

    </footer>

    <!--[if lt IE 7]>
      <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
    <![endif]-->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script src="//crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/md5.js"></script>
<script defer src="/javascripts/octopress.js"></script>




<script>
  var disqus_shortname = 'tlgh';
  
    
    // var disqus_developer = 1;
    var disqus_identifier = 'http://www.kodama.gr/2013/07/28/using-git-rebase-to-remove-duplicate-cherry-picked-commits/';
    var disqus_url = 'http://www.kodama.gr/2013/07/28/using-git-rebase-to-remove-duplicate-cherry-picked-commits/';
    var disqus_script = 'embed.js';
  
  (function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());
</script>




<script>
  $(document).ready(function(){
    if (!window.jXHR){
      var jxhr = document.createElement('script');
      jxhr.type = 'text/javascript';
      jxhr.src = '/javascripts/libs/jXHR.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jxhr, s);
    }

    github.showRepos({
      user: 'tlatsas',
      count: 10,
      skip_forks: false,
      target: '#gh_repos'
    });
  });
</script>
<script src="/javascripts/github.js"></script>






  </body>
</html>